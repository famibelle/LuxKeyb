name: ğŸš€ Release Clavier CrÃ©ole

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:
    inputs:
      version:
        description: 'Version Ã  publier (ex: v3.1.0)'
        required: true
        default: 'v3.1.0'

jobs:
  create-release:
    name: ğŸ“¦ Create GitHub Release
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
      
    - name: â˜• Setup JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        
    - name: ğŸ“± Grant Execute Permission for Gradlew
      run: chmod +x android_keyboard/gradlew
      
    - name: ï¿½ Verify Project Structure
      run: |
        echo "ğŸ“‚ Project structure verification:"
        ls -la android_keyboard/
        echo "ğŸ“± Gradle wrapper check:"
        ls -la android_keyboard/gradlew*
      
    - name: ğŸ”¨ Build Release APK
      working-directory: android_keyboard
      run: ./gradlew assembleRelease
        
    - name: ğŸ“ Extract Release Notes
      id: extract_notes
      run: |
        VERSION=${{ github.event.inputs.version || github.ref_name }}
        echo "version=$VERSION" >> $GITHUB_OUTPUT
        
        # GÃ©nÃ©rer les notes de version automatiquement
        cat > release_notes.md << EOF
        # ğŸ‡¬ğŸ‡µ Clavier CrÃ©ole GuadeloupÃ©en $VERSION
        
        ## ğŸŒŸ NouveautÃ©s
        
        ### âŒ¨ï¸ Layout AZERTY CrÃ©ole OptimisÃ©
        - Layout intÃ©grÃ© : \`azertyuiopÃ Ã©\` / \`qsdfghjklmÃ²\` / \`wxcvbnÃ¨\`
        - AccÃ¨s direct aux caractÃ¨res crÃ©oles essentiels
        - Interface compacte et ergonomique
        
        ### ğŸ¯ FonctionnalitÃ©s
        - âœ… **1 867 mots crÃ©oles** dans le dictionnaire
        - âœ… **Suggestions intelligentes** en temps rÃ©el
        - âœ… **Accents crÃ©oles** intÃ©grÃ©s au layout
        - âœ… **Mode numÃ©rique** avec basculement fluide
        - âœ… **Design GuadeloupÃ©en** avec couleurs tropicales
        
        ### ğŸ”§ AmÃ©liorations Techniques
        - Performance optimisÃ©e pour Android 7.0+
        - Interface InputMethodService native
        - Gestion avancÃ©e des majuscules/minuscules
        - Appuis longs pour accents additionnels
        
        ## ğŸ“± Installation
        
        1. TÃ©lÃ©charger l'APK ci-dessous
        2. Autoriser l'installation d'applications tierces
        3. Installer \`Potomitan_Kreyol_Keyboard_$VERSION.apk\`
        4. Activer le clavier dans ParamÃ¨tres > Langues et saisie
        
        ## ğŸï¸ Ã€ propos
        
        **Potomitanâ„¢** - Clavier intelligent pour la saisie en **KreyÃ²l GuadeloupÃ©en**
        
        DÃ©veloppÃ© avec â¤ï¸ pour prÃ©server et promouvoir la langue crÃ©ole guadeloupÃ©enne.
        EOF
        
    - name: ğŸ·ï¸ Create Release
      uses: ncipollo/release-action@v1
      with:
        tag: ${{ steps.extract_notes.outputs.version }}
        name: "ğŸ‡¬ğŸ‡µ Clavier CrÃ©ole GuadeloupÃ©en ${{ steps.extract_notes.outputs.version }}"
        bodyFile: release_notes.md
        artifacts: "android_keyboard/app/build/outputs/apk/release/*.apk"
        draft: false
        prerelease: false
        generateReleaseNotes: true
        token: ${{ secrets.GITHUB_TOKEN }}
        
    - name: ğŸ“¢ Release Success
      run: |
        echo "ğŸ‰ âœ… RELEASE CRÃ‰Ã‰E AVEC SUCCÃˆS !"
        echo "ğŸ‡¬ğŸ‡µ Clavier CrÃ©ole GuadeloupÃ©en ${{ steps.extract_notes.outputs.version }}"
        echo "ğŸ“± APK disponible dans la release GitHub"
        echo "ğŸ”— https://github.com/${{ github.repository }}/releases/tag/${{ steps.extract_notes.outputs.version }}"