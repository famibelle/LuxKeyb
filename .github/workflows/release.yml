name: ğŸ‡¬ğŸ‡µ Build and Release Potomitan Kreyol Keyboard

on:
  push:
    tags:
      - 'v*.*.*'
  workflow_dispatch:
    inputs:
      version:
        description: 'Version number (e.g., v1.0.0)'
        required: true
        default: 'v1.0.0'

jobs:
  build-and-release:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: â˜• Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        
    - name: ğŸ˜ Setup Gradle
      uses: gradle/gradle-build-action@v2
      
    - name: ğŸ”§ Make gradlew executable
      run: chmod +x android_keyboard/gradlew
      
    - name: ğŸ—ï¸ Build Debug APK
      run: |
        cd android_keyboard
        ./gradlew assembleDebug
        
    - name: ğŸ—ï¸ Build Release APK
      run: |
        cd android_keyboard
        ./gradlew assembleRelease
        
    - name: ğŸ“¦ Get APK names
      id: apk_names
      run: |
        cd android_keyboard
        DEBUG_APK=$(find app/build/outputs/apk/debug -name "*.apk" | head -1)
        RELEASE_APK=$(find app/build/outputs/apk/release -name "*.apk" | head -1)
        echo "debug_apk=$DEBUG_APK" >> $GITHUB_OUTPUT
        echo "release_apk=$RELEASE_APK" >> $GITHUB_OUTPUT
        
    - name: ğŸ“Š APK Info
      run: |
        cd android_keyboard
        echo "ğŸ” Debug APK:"
        ls -lh "${{ steps.apk_names.outputs.debug_apk }}"
        echo "ğŸ” Release APK:"
        ls -lh "${{ steps.apk_names.outputs.release_apk }}"
        
    - name: ğŸš€ Create Release
      uses: softprops/action-gh-release@v1
      with:
        tag_name: ${{ github.event.inputs.version || github.ref_name }}
        name: ğŸ‡¬ğŸ‡µ KlaviÃ© KreyÃ²l Karukera ${{ github.event.inputs.version || github.ref_name }}
        body: |
          ## ğŸ‡¬ğŸ‡µ KlaviÃ© KreyÃ²l Karukera â€¢ Potomitanâ„¢
          
          **Nouveau clavier crÃ©ole pour la Guadeloupe !**
          
          ### âœ¨ FonctionnalitÃ©s :
          - ğŸŒˆ Design moderne caribÃ©en (bleu caraÃ¯be, jaune soleil, vert canne)
          - ğŸ“ Suggestions intelligentes basÃ©es sur un vrai dictionnaire crÃ©ole
          - ğŸ”¤ Accents crÃ©oles (Ã , Ã¨, Ã², etc.) avec long-press
          - ğŸ“š Dictionnaire de 5910 mots crÃ©oles authentiques
          - ğŸ¯ Sources littÃ©raires intÃ©grÃ©es (Telchid, Rupaire, Fontes, etc.)
          
          ### ğŸ“± Installation :
          1. TÃ©lÃ©chargez le fichier **Release APK** (recommandÃ©) ou Debug APK
          2. Autorisez l'installation d'applications inconnues
          3. Installez l'APK
          4. Activez le clavier dans ParamÃ¨tres â†’ Langues et saisie
          
          ### ğŸ“Š Tailles des fichiers :
          - **Release APK** : ~2.6 MB (optimisÃ©)
          - **Debug APK** : ~3.4 MB (avec infos de debug)
          
          ---
          **AlÃ© douvan Ã©pi klaviÃ© kreyÃ²l-la !** âŒ¨ï¸âœ¨
        files: |
          android_keyboard/${{ steps.apk_names.outputs.debug_apk }}
          android_keyboard/${{ steps.apk_names.outputs.release_apk }}
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
