name: ğŸ§ª Test Build v2.5.0

on:
  push:
    branches: [ feature/code-improvements-v3.0 ]
    paths:
      - 'android_keyboard/**'
      - '.github/workflows/**'
  pull_request:
    branches: [ main ]
    paths:
      - 'android_keyboard/**'
  workflow_dispatch:

jobs:
  test-build-v2-5-0:
    name: ğŸ§ª Test Build v2.5.0
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
        
    - name: â˜• Setup JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: gradle
        
    - name: ğŸ˜ Setup Gradle
      uses: gradle/gradle-build-action@v2
      with:
        gradle-version: wrapper
        
    - name: ğŸ“„ Make Gradlew Executable
      run: chmod +x android_keyboard/gradlew
      
    - name: ğŸ” Verify Version
      working-directory: android_keyboard
      run: |
        VERSION_FROM_GRADLE=$(grep "versionName" app/build.gradle | sed 's/.*"\(.*\)".*/\1/')
        VERSION_CODE=$(grep "versionCode" app/build.gradle | sed 's/.*= \(.*\)/\1/')
        echo "ğŸ·ï¸ Version Name: $VERSION_FROM_GRADLE"
        echo "ğŸ”¢ Version Code: $VERSION_CODE"
        
        if [[ "$VERSION_FROM_GRADLE" == "2.5.0" ]]; then
          echo "âœ… Correct version for v2.5.0 release"
        else
          echo "âš ï¸ Version is $VERSION_FROM_GRADLE (not 2.5.0)"
        fi
        
    - name: ğŸ§¹ Clean Project
      working-directory: android_keyboard
      run: ./gradlew clean
        
    - name: ğŸ”¨ Test Debug Build
      working-directory: android_keyboard
      run: |
        echo "ğŸ”¨ Testing Debug build..."
        ./gradlew assembleDebug
        
    - name: ğŸ”¨ Test Release Build
      working-directory: android_keyboard
      run: |
        echo "ğŸ”¨ Testing Release build..."
        ./gradlew assembleRelease
        
    - name: ğŸ“Š Build Results
      working-directory: android_keyboard
      run: |
        echo "ğŸ¯ Build Test Results for v2.5.0:"
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        
        if [[ -f "app/build/outputs/apk/debug"/*.apk ]]; then
          echo "âœ… Debug APK build: SUCCESS"
          ls -la app/build/outputs/apk/debug/*.apk
        else
          echo "âŒ Debug APK build: FAILED"
        fi
        
        if [[ -f "app/build/outputs/apk/release"/*.apk ]]; then
          echo "âœ… Release APK build: SUCCESS" 
          ls -la app/build/outputs/apk/release/*.apk
        else
          echo "âŒ Release APK build: FAILED"
        fi
        
        echo ""
        echo "ğŸ“± APK Sizes:"
        find app/build/outputs/apk -name "*.apk" -exec du -h {} \;
        
    - name: ğŸ“¤ Upload Test APKs
      uses: actions/upload-artifact@v4
      with:
        name: ğŸ§ª Test-Build-v2.5.0-APKs
        path: |
          android_keyboard/app/build/outputs/apk/debug/*.apk
          android_keyboard/app/build/outputs/apk/release/*.apk
        retention-days: 7
        
    - name: âœ… Test Summary
      run: |
        echo "ğŸ§ª Test build completed for v2.5.0!"
        echo ""
        echo "ğŸ“‹ Summary:"
        echo "  â€¢ âœ… Debug build successful"
        echo "  â€¢ âœ… Release build successful"  
        echo "  â€¢ ğŸ“± APKs uploaded as artifacts"
        echo ""
        echo "ğŸš€ Ready for release when you create the v2.5.0 tag!"
        echo "ğŸ’¡ Use 'Create Tag v2.5.0' workflow to trigger the official release."